<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class HTML::Pipeline::EmojiFilter - html-pipeline-2.3.0 Documentation</title>

<link type="text/css" media="screen" href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../../index.html">Home</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  

  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/html/pipeline/emoji_filter.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">Filter
  
</nav>

    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li ><a href="#method-c-emoji_names">::emoji_names</a>
    
    <li ><a href="#method-c-emoji_pattern">::emoji_pattern</a>
    
    <li ><a href="#method-i-asset_path">#asset_path</a>
    
    <li ><a href="#method-i-asset_root">#asset_root</a>
    
    <li ><a href="#method-i-call">#call</a>
    
    <li ><a href="#method-i-emoji_filename">#emoji_filename</a>
    
    <li ><a href="#method-i-emoji_image_filter">#emoji_image_filter</a>
    
    <li ><a href="#method-i-emoji_image_tag">#emoji_image_tag</a>
    
    <li ><a href="#method-i-emoji_pattern">#emoji_pattern</a>
    
    <li ><a href="#method-i-emoji_url">#emoji_url</a>
    
    <li ><a href="#method-i-ignored_ancestor_tags">#ignored_ancestor_tags</a>
    
    <li ><a href="#method-i-validate">#validate</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    
    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../../HTML.html">HTML</a>
  
    <li><a href="../../HTML/Pipeline.html">HTML::Pipeline</a>
  
    <li><a href="../../HTML/Pipeline/AbsoluteSourceFilter.html">HTML::Pipeline::AbsoluteSourceFilter</a>
  
    <li><a href="../../HTML/Pipeline/AutolinkFilter.html">HTML::Pipeline::AutolinkFilter</a>
  
    <li><a href="../../HTML/Pipeline/BodyContent.html">HTML::Pipeline::BodyContent</a>
  
    <li><a href="../../HTML/Pipeline/CamoFilter.html">HTML::Pipeline::CamoFilter</a>
  
    <li><a href="../../HTML/Pipeline/EmailReplyFilter.html">HTML::Pipeline::EmailReplyFilter</a>
  
    <li><a href="../../HTML/Pipeline/EmojiFilter.html">HTML::Pipeline::EmojiFilter</a>
  
    <li><a href="../../HTML/Pipeline/Filter.html">HTML::Pipeline::Filter</a>
  
    <li><a href="../../HTML/Pipeline/Filter/InvalidDocumentException.html">HTML::Pipeline::Filter::InvalidDocumentException</a>
  
    <li><a href="../../HTML/Pipeline/HttpsFilter.html">HTML::Pipeline::HttpsFilter</a>
  
    <li><a href="../../HTML/Pipeline/ImageFilter.html">HTML::Pipeline::ImageFilter</a>
  
    <li><a href="../../HTML/Pipeline/ImageMaxWidthFilter.html">HTML::Pipeline::ImageMaxWidthFilter</a>
  
    <li><a href="../../HTML/Pipeline/MarkdownFilter.html">HTML::Pipeline::MarkdownFilter</a>
  
    <li><a href="../../HTML/Pipeline/MentionFilter.html">HTML::Pipeline::MentionFilter</a>
  
    <li><a href="../../HTML/Pipeline/MissingDependencyError.html">HTML::Pipeline::MissingDependencyError</a>
  
    <li><a href="../../HTML/Pipeline/PlainTextInputFilter.html">HTML::Pipeline::PlainTextInputFilter</a>
  
    <li><a href="../../HTML/Pipeline/SanitizationFilter.html">HTML::Pipeline::SanitizationFilter</a>
  
    <li><a href="../../HTML/Pipeline/SyntaxHighlightFilter.html">HTML::Pipeline::SyntaxHighlightFilter</a>
  
    <li><a href="../../HTML/Pipeline/TableOfContentsFilter.html">HTML::Pipeline::TableOfContentsFilter</a>
  
    <li><a href="../../HTML/Pipeline/TextFilter.html">HTML::Pipeline::TextFilter</a>
  
    <li><a href="../../HTML/Pipeline/TextileFilter.html">HTML::Pipeline::TextileFilter</a>
  
    <li><a href="../../Nokogiri.html">Nokogiri</a>
  
    <li><a href="../../Nokogiri/XML.html">Nokogiri::XML</a>
  
    <li><a href="../../Nokogiri/XML/Node.html">Nokogiri::XML::Node</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class HTML::Pipeline::EmojiFilter</h1>

  <div id="description" class="description">
    
<p><a href="../../HTML.html">HTML</a> filter that replaces :emoji: with
images.</p>

<p>Context:</p>

<pre>:asset_root (required) - base url to link to emoji sprite
:asset_path (optional) - url path to link to emoji sprite. :file_name can be used as a placeholder for the sprite file name. If no asset_path is set &quot;emoji/:file_name&quot; is used.
:ignored_ancestor_tags (optional) - Tags to stop the emojification. Node has matched ancestor HTML tags will not be emojified. Default to pre, code, and tt tags. Extra tags please pass in the form of array, e.g., %w(blockquote summary).</pre>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="DEFAULT_IGNORED_ANCESTOR_TAGS">DEFAULT_IGNORED_ANCESTOR_TAGS
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="private-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Private Class Methods</h3>

    
      <div id="method-c-emoji_names" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">emoji_names</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="emoji_names-source">
            <pre><span class="ruby-comment"># File lib/html/pipeline/emoji_filter.rb, line 90</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">emoji_names</span>
  <span class="ruby-constant">Emoji</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:aliases</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">sort</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- emoji_names-source -->
          
        </div>

        

        
      </div><!-- emoji_names-method -->

    
      <div id="method-c-emoji_pattern" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">emoji_pattern</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Build a regexp that matches all valid :emoji: names.</p>
          
          

          
          <div class="method-source-code" id="emoji_pattern-source">
            <pre><span class="ruby-comment"># File lib/html/pipeline/emoji_filter.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">emoji_pattern</span>
  <span class="ruby-ivar">@emoji_pattern</span> <span class="ruby-operator">||=</span> <span class="ruby-node">/:(#{emoji_names.map { |name| Regexp.escape(name) }.join(&#39;|&#39;)}):/</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- emoji_pattern-source -->
          
        </div>

        

        
      </div><!-- emoji_pattern-method -->

    
    </section><!-- private-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-asset_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">asset_path</span><span
            class="method-args">(name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The url path to link emoji sprites</p>

<p>:file_name can be used in the <a
href="EmojiFilter.html#method-i-asset_path">#asset_path</a> as a
placeholder for the sprite file name. If no <a
href="EmojiFilter.html#method-i-asset_path">#asset_path</a> is set in the
context “emoji/:file_name” is used. Returns the context&#39;s <a
href="EmojiFilter.html#method-i-asset_path">#asset_path</a> or the default
path if no context <a
href="EmojiFilter.html#method-i-asset_path">#asset_path</a> is given.</p>
          
          

          
          <div class="method-source-code" id="asset_path-source">
            <pre><span class="ruby-comment"># File lib/html/pipeline/emoji_filter.rb, line 62</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">asset_path</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">context</span>[<span class="ruby-value">:asset_path</span>]
    <span class="ruby-identifier">context</span>[<span class="ruby-value">:asset_path</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;:file_name&quot;</span>, <span class="ruby-identifier">emoji_filename</span>(<span class="ruby-identifier">name</span>))
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;emoji&quot;</span>, <span class="ruby-identifier">emoji_filename</span>(<span class="ruby-identifier">name</span>))
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- asset_path-source -->
          
        </div>

        

        
      </div><!-- asset_path-method -->

    
      <div id="method-i-asset_root" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">asset_root</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The base url to link emoji sprites</p>

<p>Raises ArgumentError if context option has not been provided. Returns the
context&#39;s asset_root.</p>
          
          

          
          <div class="method-source-code" id="asset_root-source">
            <pre><span class="ruby-comment"># File lib/html/pipeline/emoji_filter.rb, line 54</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">asset_root</span>
  <span class="ruby-identifier">context</span>[<span class="ruby-value">:asset_root</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- asset_root-source -->
          
        </div>

        

        
      </div><!-- asset_root-method -->

    
      <div id="method-i-call" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">call</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="call-source">
            <pre><span class="ruby-comment"># File lib/html/pipeline/emoji_filter.rb, line 21</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">call</span>
  <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">search</span>(<span class="ruby-string">&#39;.//text()&#39;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">content</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">to_html</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">content</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&#39;:&#39;</span>)
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_ancestor?</span>(<span class="ruby-identifier">node</span>, <span class="ruby-identifier">ignored_ancestor_tags</span>)
    <span class="ruby-identifier">html</span> = <span class="ruby-identifier">emoji_image_filter</span>(<span class="ruby-identifier">content</span>)
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">html</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">content</span>
    <span class="ruby-identifier">node</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">html</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">doc</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- call-source -->
          
        </div>

        

        
      </div><!-- call-method -->

    
      <div id="method-i-emoji_image_filter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">emoji_image_filter</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Replace :emoji: with corresponding images.</p>

<p>text - String text to replace :emoji: in.</p>

<p>Returns a String with :emoji: replaced with images.</p>
          
          

          
          <div class="method-source-code" id="emoji_image_filter-source">
            <pre><span class="ruby-comment"># File lib/html/pipeline/emoji_filter.rb, line 44</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">emoji_image_filter</span>(<span class="ruby-identifier">text</span>)
  <span class="ruby-identifier">text</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-identifier">emoji_pattern</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">emoji_image_tag</span>(<span class="ruby-node">$1</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- emoji_image_filter-source -->
          
        </div>

        

        
      </div><!-- emoji_image_filter-method -->

    
      <div id="method-i-validate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validate</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Implementation of validate hook. Errors should raise exceptions or use an
existing validator.</p>
          
          

          
          <div class="method-source-code" id="validate-source">
            <pre><span class="ruby-comment"># File lib/html/pipeline/emoji_filter.rb, line 35</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">validate</span>
  <span class="ruby-identifier">needs</span> <span class="ruby-value">:asset_root</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- validate-source -->
          
        </div>

        

        
      </div><!-- validate-method -->

    
    </section><!-- public-instance-method-details -->
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Private Instance Methods</h3>

    
      <div id="method-i-emoji_filename" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">emoji_filename</span><span
            class="method-args">(name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="emoji_filename-source">
            <pre><span class="ruby-comment"># File lib/html/pipeline/emoji_filter.rb, line 94</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">emoji_filename</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-constant">Emoji</span>.<span class="ruby-identifier">find_by_alias</span>(<span class="ruby-identifier">name</span>).<span class="ruby-identifier">image_filename</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- emoji_filename-source -->
          
        </div>

        

        
      </div><!-- emoji_filename-method -->

    
      <div id="method-i-emoji_image_tag" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">emoji_image_tag</span><span
            class="method-args">(name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Build an emoji image tag</p>
          
          

          
          <div class="method-source-code" id="emoji_image_tag-source">
            <pre><span class="ruby-comment"># File lib/html/pipeline/emoji_filter.rb, line 73</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">emoji_image_tag</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-node">&quot;&lt;img class=&#39;emoji&#39; title=&#39;:#{name}:&#39; alt=&#39;:#{name}:&#39; src=&#39;#{emoji_url(name)}&#39; height=&#39;20&#39; width=&#39;20&#39; align=&#39;absmiddle&#39; /&gt;&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- emoji_image_tag-source -->
          
        </div>

        

        
      </div><!-- emoji_image_tag-method -->

    
      <div id="method-i-emoji_pattern" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">emoji_pattern</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="emoji_pattern-source">
            <pre><span class="ruby-comment"># File lib/html/pipeline/emoji_filter.rb, line 86</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">emoji_pattern</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">emoji_pattern</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- emoji_pattern-source -->
          
        </div>

        

        
      </div><!-- emoji_pattern-method -->

    
      <div id="method-i-emoji_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">emoji_url</span><span
            class="method-args">(name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="emoji_url-source">
            <pre><span class="ruby-comment"># File lib/html/pipeline/emoji_filter.rb, line 77</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">emoji_url</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">asset_root</span>, <span class="ruby-identifier">asset_path</span>(<span class="ruby-identifier">name</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- emoji_url-source -->
          
        </div>

        

        
      </div><!-- emoji_url-method -->

    
      <div id="method-i-ignored_ancestor_tags" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ignored_ancestor_tags</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return ancestor tags to stop the emojification.</p>

<p>@return [Array&lt;String&gt;] Ancestor tags.</p>
          
          

          
          <div class="method-source-code" id="ignored_ancestor_tags-source">
            <pre><span class="ruby-comment"># File lib/html/pipeline/emoji_filter.rb, line 101</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ignored_ancestor_tags</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">context</span>[<span class="ruby-value">:ignored_ancestor_tags</span>]
    <span class="ruby-constant">DEFAULT_IGNORED_ANCESTOR_TAGS</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">context</span>[<span class="ruby-value">:ignored_ancestor_tags</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">DEFAULT_IGNORED_ANCESTOR_TAGS</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- ignored_ancestor_tags-source -->
          
        </div>

        

        
      </div><!-- ignored_ancestor_tags-method -->

    
    </section><!-- private-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 4.0.0.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

