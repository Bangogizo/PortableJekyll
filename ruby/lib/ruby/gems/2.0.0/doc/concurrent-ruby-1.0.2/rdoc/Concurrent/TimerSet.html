<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class Concurrent::TimerSet - concurrent-ruby-1.0.2 Documentation</title>

<link type="text/css" media="screen" href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../index.html">Home</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  

  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/concurrent/executor/timer_set.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="RubyExecutorService.html">Concurrent::RubyExecutorService</a>
  
</nav>

    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-kill">#kill</a>
    
    <li ><a href="#method-i-ns_initialize">#ns_initialize</a>
    
    <li ><a href="#method-i-ns_post_task">#ns_post_task</a>
    
    <li ><a href="#method-i-ns_shutdown_execution">#ns_shutdown_execution</a>
    
    <li ><a href="#method-i-post">#post</a>
    
    <li ><a href="#method-i-post_task">#post_task</a>
    
    <li ><a href="#method-i-process_tasks">#process_tasks</a>
    
    <li ><a href="#method-i-remove_task">#remove_task</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../CHANGELOG_md.html">CHANGELOG</a>
  
    <li class="file"><a href="../LICENSE_txt.html">LICENSE</a>
  
    <li class="file"><a href="../README_md.html">README</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../Concurrent.html">Concurrent</a>
  
    <li><a href="../Concurrent/AbstractExchanger.html">Concurrent::AbstractExchanger</a>
  
    <li><a href="../Concurrent/AbstractExecutorService.html">Concurrent::AbstractExecutorService</a>
  
    <li><a href="../Concurrent/AbstractThreadLocalVar.html">Concurrent::AbstractThreadLocalVar</a>
  
    <li><a href="../Concurrent/Agent.html">Concurrent::Agent</a>
  
    <li><a href="../Concurrent/Agent/Error.html">Concurrent::Agent::Error</a>
  
    <li><a href="../Concurrent/Agent/ValidationError.html">Concurrent::Agent::ValidationError</a>
  
    <li><a href="../Concurrent/Array.html">Concurrent::Array</a>
  
    <li><a href="../Concurrent/Async.html">Concurrent::Async</a>
  
    <li><a href="../Concurrent/Async/AsyncDelegator.html">Concurrent::Async::AsyncDelegator</a>
  
    <li><a href="../Concurrent/Async/AwaitDelegator.html">Concurrent::Async::AwaitDelegator</a>
  
    <li><a href="../Concurrent/Async/ClassMethods.html">Concurrent::Async::ClassMethods</a>
  
    <li><a href="../Concurrent/AtExitImplementation.html">Concurrent::AtExitImplementation</a>
  
    <li><a href="../Concurrent/Atom.html">Concurrent::Atom</a>
  
    <li><a href="../Concurrent/AtomicBoolean.html">Concurrent::AtomicBoolean</a>
  
    <li><a href="../Concurrent/AtomicDirectUpdate.html">Concurrent::AtomicDirectUpdate</a>
  
    <li><a href="../Concurrent/AtomicFixnum.html">Concurrent::AtomicFixnum</a>
  
    <li><a href="../Concurrent/AtomicNumericCompareAndSetWrapper.html">Concurrent::AtomicNumericCompareAndSetWrapper</a>
  
    <li><a href="../Concurrent/AtomicReference.html">Concurrent::AtomicReference</a>
  
    <li><a href="../Concurrent/CAtomicReference.html">Concurrent::CAtomicReference</a>
  
    <li><a href="../Concurrent/CachedThreadPool.html">Concurrent::CachedThreadPool</a>
  
    <li><a href="../Concurrent/Collection.html">Concurrent::Collection</a>
  
    <li><a href="../Concurrent/Collection/AtomicReferenceMapBackend.html">Concurrent::Collection::AtomicReferenceMapBackend</a>
  
    <li><a href="../Concurrent/Collection/AtomicReferenceMapBackend/Node.html">Concurrent::Collection::AtomicReferenceMapBackend::Node</a>
  
    <li><a href="../Concurrent/Collection/AtomicReferenceMapBackend/Table.html">Concurrent::Collection::AtomicReferenceMapBackend::Table</a>
  
    <li><a href="../Concurrent/Collection/CopyOnNotifyObserverSet.html">Concurrent::Collection::CopyOnNotifyObserverSet</a>
  
    <li><a href="../Concurrent/Collection/CopyOnWriteObserverSet.html">Concurrent::Collection::CopyOnWriteObserverSet</a>
  
    <li><a href="../Concurrent/Collection/JavaNonConcurrentPriorityQueue.html">Concurrent::Collection::JavaNonConcurrentPriorityQueue</a>
  
    <li><a href="../Concurrent/Collection/MriMapBackend.html">Concurrent::Collection::MriMapBackend</a>
  
    <li><a href="../Concurrent/Collection/NonConcurrentMapBackend.html">Concurrent::Collection::NonConcurrentMapBackend</a>
  
    <li><a href="../Concurrent/Collection/NonConcurrentPriorityQueue.html">Concurrent::Collection::NonConcurrentPriorityQueue</a>
  
    <li><a href="../Concurrent/Collection/RubyNonConcurrentPriorityQueue.html">Concurrent::Collection::RubyNonConcurrentPriorityQueue</a>
  
    <li><a href="../Concurrent/Collection/SynchronizedMapBackend.html">Concurrent::Collection::SynchronizedMapBackend</a>
  
    <li><a href="../Concurrent/Concern.html">Concurrent::Concern</a>
  
    <li><a href="../Concurrent/Concern/Deprecation.html">Concurrent::Concern::Deprecation</a>
  
    <li><a href="../Concurrent/Concern/Dereferenceable.html">Concurrent::Concern::Dereferenceable</a>
  
    <li><a href="../Concurrent/Concern/Logging.html">Concurrent::Concern::Logging</a>
  
    <li><a href="../Concurrent/Concern/Obligation.html">Concurrent::Concern::Obligation</a>
  
    <li><a href="../Concurrent/Concern/Observable.html">Concurrent::Concern::Observable</a>
  
    <li><a href="../Concurrent/ConcurrentUpdateError.html">Concurrent::ConcurrentUpdateError</a>
  
    <li><a href="../Concurrent/CountDownLatch.html">Concurrent::CountDownLatch</a>
  
    <li><a href="../Concurrent/CyclicBarrier.html">Concurrent::CyclicBarrier</a>
  
    <li><a href="../Concurrent/Delay.html">Concurrent::Delay</a>
  
    <li><a href="../Concurrent/DependencyCounter.html">Concurrent::DependencyCounter</a>
  
    <li><a href="../Concurrent/Edge.html">Concurrent::Edge</a>
  
    <li><a href="../Concurrent/Event.html">Concurrent::Event</a>
  
    <li><a href="../Concurrent/Exchanger.html">Concurrent::Exchanger</a>
  
    <li><a href="../Concurrent/ExecutorService.html">Concurrent::ExecutorService</a>
  
    <li><a href="../Concurrent/FixedThreadPool.html">Concurrent::FixedThreadPool</a>
  
    <li><a href="../Concurrent/Future.html">Concurrent::Future</a>
  
    <li><a href="../Concurrent/Hash.html">Concurrent::Hash</a>
  
    <li><a href="../Concurrent/IVar.html">Concurrent::IVar</a>
  
    <li><a href="../Concurrent/ImmediateExecutor.html">Concurrent::ImmediateExecutor</a>
  
    <li><a href="../Concurrent/ImmutableStruct.html">Concurrent::ImmutableStruct</a>
  
    <li><a href="../Concurrent/IndirectImmediateExecutor.html">Concurrent::IndirectImmediateExecutor</a>
  
    <li><a href="../Concurrent/JavaAtomicReference.html">Concurrent::JavaAtomicReference</a>
  
    <li><a href="../Concurrent/JavaCountDownLatch.html">Concurrent::JavaCountDownLatch</a>
  
    <li><a href="../Concurrent/JavaExchanger.html">Concurrent::JavaExchanger</a>
  
    <li><a href="../Concurrent/JavaExecutorService.html">Concurrent::JavaExecutorService</a>
  
    <li><a href="../Concurrent/JavaExecutorService/Job.html">Concurrent::JavaExecutorService::Job</a>
  
    <li><a href="../Concurrent/JavaSingleThreadExecutor.html">Concurrent::JavaSingleThreadExecutor</a>
  
    <li><a href="../Concurrent/JavaThreadLocalVar.html">Concurrent::JavaThreadLocalVar</a>
  
    <li><a href="../Concurrent/JavaThreadPoolExecutor.html">Concurrent::JavaThreadPoolExecutor</a>
  
    <li><a href="../Concurrent/LazyRegister.html">Concurrent::LazyRegister</a>
  
    <li><a href="../Concurrent/MVar.html">Concurrent::MVar</a>
  
    <li><a href="../Concurrent/Map.html">Concurrent::Map</a>
  
    <li><a href="../Concurrent/Maybe.html">Concurrent::Maybe</a>
  
    <li><a href="../Concurrent/MutableStruct.html">Concurrent::MutableStruct</a>
  
    <li><a href="../Concurrent/MutexAtomicBoolean.html">Concurrent::MutexAtomicBoolean</a>
  
    <li><a href="../Concurrent/MutexAtomicFixnum.html">Concurrent::MutexAtomicFixnum</a>
  
    <li><a href="../Concurrent/MutexAtomicReference.html">Concurrent::MutexAtomicReference</a>
  
    <li><a href="../Concurrent/MutexCountDownLatch.html">Concurrent::MutexCountDownLatch</a>
  
    <li><a href="../Concurrent/MutexSemaphore.html">Concurrent::MutexSemaphore</a>
  
    <li><a href="../Concurrent/Options.html">Concurrent::Options</a>
  
    <li><a href="../Concurrent/Process.html">Concurrent::Process</a>
  
    <li><a href="../Concurrent/Promise.html">Concurrent::Promise</a>
  
    <li><a href="../Concurrent/RbxAtomicReference.html">Concurrent::RbxAtomicReference</a>
  
    <li><a href="../Concurrent/ReadWriteLock.html">Concurrent::ReadWriteLock</a>
  
    <li><a href="../Concurrent/ReentrantReadWriteLock.html">Concurrent::ReentrantReadWriteLock</a>
  
    <li><a href="../Concurrent/RubyExchanger.html">Concurrent::RubyExchanger</a>
  
    <li><a href="../Concurrent/RubyExchanger/Node.html">Concurrent::RubyExchanger::Node</a>
  
    <li><a href="../Concurrent/RubyExecutorService.html">Concurrent::RubyExecutorService</a>
  
    <li><a href="../Concurrent/RubySingleThreadExecutor.html">Concurrent::RubySingleThreadExecutor</a>
  
    <li><a href="../Concurrent/RubyThreadLocalVar.html">Concurrent::RubyThreadLocalVar</a>
  
    <li><a href="../Concurrent/RubyThreadPoolExecutor.html">Concurrent::RubyThreadPoolExecutor</a>
  
    <li><a href="../Concurrent/RubyThreadPoolExecutor/Worker.html">Concurrent::RubyThreadPoolExecutor::Worker</a>
  
    <li><a href="../Concurrent/SafeTaskExecutor.html">Concurrent::SafeTaskExecutor</a>
  
    <li><a href="../Concurrent/ScheduledTask.html">Concurrent::ScheduledTask</a>
  
    <li><a href="../Concurrent/Semaphore.html">Concurrent::Semaphore</a>
  
    <li><a href="../Concurrent/SerialExecutorService.html">Concurrent::SerialExecutorService</a>
  
    <li><a href="../Concurrent/SerializedExecution.html">Concurrent::SerializedExecution</a>
  
    <li><a href="../Concurrent/SerializedExecutionDelegator.html">Concurrent::SerializedExecutionDelegator</a>
  
    <li><a href="../Concurrent/SettableStruct.html">Concurrent::SettableStruct</a>
  
    <li><a href="../Concurrent/SimpleExecutorService.html">Concurrent::SimpleExecutorService</a>
  
    <li><a href="../Concurrent/SingleThreadExecutor.html">Concurrent::SingleThreadExecutor</a>
  
    <li><a href="../Concurrent/Synchronization.html">Concurrent::Synchronization</a>
  
    <li><a href="../Concurrent/Synchronization/AbstractLockableObject.html">Concurrent::Synchronization::AbstractLockableObject</a>
  
    <li><a href="../Concurrent/Synchronization/AbstractObject.html">Concurrent::Synchronization::AbstractObject</a>
  
    <li><a href="../Concurrent/Synchronization/AbstractStruct.html">Concurrent::Synchronization::AbstractStruct</a>
  
    <li><a href="../Concurrent/Synchronization/Condition.html">Concurrent::Synchronization::Condition</a>
  
    <li><a href="../Concurrent/Synchronization/JRubyAttrVolatile.html">Concurrent::Synchronization::JRubyAttrVolatile</a>
  
    <li><a href="../Concurrent/Synchronization/JRubyAttrVolatile/ClassMethods.html">Concurrent::Synchronization::JRubyAttrVolatile::ClassMethods</a>
  
    <li><a href="../Concurrent/Synchronization/JRubyLockableObject.html">Concurrent::Synchronization::JRubyLockableObject</a>
  
    <li><a href="../Concurrent/Synchronization/JRubyObject.html">Concurrent::Synchronization::JRubyObject</a>
  
    <li><a href="../Concurrent/Synchronization/Lock.html">Concurrent::Synchronization::Lock</a>
  
    <li><a href="../Concurrent/Synchronization/LockableObject.html">Concurrent::Synchronization::LockableObject</a>
  
    <li><a href="../Concurrent/Synchronization/MriAttrVolatile.html">Concurrent::Synchronization::MriAttrVolatile</a>
  
    <li><a href="../Concurrent/Synchronization/MriAttrVolatile/ClassMethods.html">Concurrent::Synchronization::MriAttrVolatile::ClassMethods</a>
  
    <li><a href="../Concurrent/Synchronization/MriLockableObject.html">Concurrent::Synchronization::MriLockableObject</a>
  
    <li><a href="../Concurrent/Synchronization/MriMonitorLockableObject.html">Concurrent::Synchronization::MriMonitorLockableObject</a>
  
    <li><a href="../Concurrent/Synchronization/MriMutexLockableObject.html">Concurrent::Synchronization::MriMutexLockableObject</a>
  
    <li><a href="../Concurrent/Synchronization/MriObject.html">Concurrent::Synchronization::MriObject</a>
  
    <li><a href="../Concurrent/Synchronization/Object.html">Concurrent::Synchronization::Object</a>
  
    <li><a href="../Concurrent/Synchronization/RbxAttrVolatile.html">Concurrent::Synchronization::RbxAttrVolatile</a>
  
    <li><a href="../Concurrent/Synchronization/RbxAttrVolatile/ClassMethods.html">Concurrent::Synchronization::RbxAttrVolatile::ClassMethods</a>
  
    <li><a href="../Concurrent/Synchronization/RbxLockableObject.html">Concurrent::Synchronization::RbxLockableObject</a>
  
    <li><a href="../Concurrent/Synchronization/RbxObject.html">Concurrent::Synchronization::RbxObject</a>
  
    <li><a href="../Concurrent/Synchronization/TruffleAttrVolatile.html">Concurrent::Synchronization::TruffleAttrVolatile</a>
  
    <li><a href="../Concurrent/Synchronization/TruffleAttrVolatile/ClassMethods.html">Concurrent::Synchronization::TruffleAttrVolatile::ClassMethods</a>
  
    <li><a href="../Concurrent/Synchronization/TruffleLockableObject.html">Concurrent::Synchronization::TruffleLockableObject</a>
  
    <li><a href="../Concurrent/Synchronization/TruffleObject.html">Concurrent::Synchronization::TruffleObject</a>
  
    <li><a href="../Concurrent/SynchronizedDelegator.html">Concurrent::SynchronizedDelegator</a>
  
    <li><a href="../Concurrent/TVar.html">Concurrent::TVar</a>
  
    <li><a href="../Concurrent/ThreadLocalVar.html">Concurrent::ThreadLocalVar</a>
  
    <li><a href="../Concurrent/ThreadPoolExecutor.html">Concurrent::ThreadPoolExecutor</a>
  
    <li><a href="../Concurrent/ThreadSafe.html">Concurrent::ThreadSafe</a>
  
    <li><a href="../Concurrent/ThreadSafe/Util.html">Concurrent::ThreadSafe::Util</a>
  
    <li><a href="../Concurrent/ThreadSafe/Util/Adder.html">Concurrent::ThreadSafe::Util::Adder</a>
  
    <li><a href="../Concurrent/ThreadSafe/Util/CheapLockable.html">Concurrent::ThreadSafe::Util::CheapLockable</a>
  
    <li><a href="../Concurrent/ThreadSafe/Util/PowerOfTwoTuple.html">Concurrent::ThreadSafe::Util::PowerOfTwoTuple</a>
  
    <li><a href="../Concurrent/ThreadSafe/Util/Striped64.html">Concurrent::ThreadSafe::Util::Striped64</a>
  
    <li><a href="../Concurrent/ThreadSafe/Util/Striped64/Cell.html">Concurrent::ThreadSafe::Util::Striped64::Cell</a>
  
    <li><a href="../Concurrent/ThreadSafe/Util/Volatile.html">Concurrent::ThreadSafe::Util::Volatile</a>
  
    <li><a href="../Concurrent/ThreadSafe/Util/XorShiftRandom.html">Concurrent::ThreadSafe::Util::XorShiftRandom</a>
  
    <li><a href="../Concurrent/TimerSet.html">Concurrent::TimerSet</a>
  
    <li><a href="../Concurrent/TimerTask.html">Concurrent::TimerTask</a>
  
    <li><a href="../Concurrent/Transaction.html">Concurrent::Transaction</a>
  
    <li><a href="../Concurrent/Tuple.html">Concurrent::Tuple</a>
  
    <li><a href="../Concurrent/Utility.html">Concurrent::Utility</a>
  
    <li><a href="../Concurrent/Utility/EngineDetector.html">Concurrent::Utility::EngineDetector</a>
  
    <li><a href="../Concurrent/Utility/NativeExtensionLoader.html">Concurrent::Utility::NativeExtensionLoader</a>
  
    <li><a href="../Concurrent/Utility/ProcessorCounter.html">Concurrent::Utility::ProcessorCounter</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Concurrent::TimerSet</h1>

  <div id="description" class="description">
    
<p>Executes a collection of tasks, each after a given delay. A master task
monitors the set and schedules each task for execution at the appropriate
time. Tasks are run on the global thread pool or on the supplied executor.
Each task is represented as a `ScheduledTask`.</p>

<p>@see <a href="ScheduledTask.html">Concurrent::ScheduledTask</a></p>

<p>@!macro monotonic_clock_warning</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(opts = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Create a new set of timed tasks.</p>

<p>@!macro [attach] executor_options</p>

<pre>@param [Hash] opts the options used to specify the executor on which to perform actions
@option opts [Executor] :executor when set use the given `Executor` instance.
  Three special values are also supported: `:task` returns the global task pool,
  `:operation` returns the global operation pool, and `:immediate` returns a new
  `ImmediateExecutor` object.</pre>
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="RubyExecutorService.html#method-c-new">Concurrent::RubyExecutorService.new</a>
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/concurrent/executor/timer_set.rb, line 30</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">opts</span> = {})
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">opts</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-kill" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">kill</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Begin an immediate shutdown. In-progress tasks will be allowed to complete
but enqueued tasks will be dismissed and no new tasks will be accepted. Has
no additional effect if the thread pool is not running.</p>
          
          

          
          <div class="method-source-code" id="kill-source">
            <pre><span class="ruby-comment"># File lib/concurrent/executor/timer_set.rb, line 64</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">kill</span>
  <span class="ruby-identifier">shutdown</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- kill-source -->
          
        </div>

        

        
      </div><!-- kill-method -->

    
      <div id="method-i-post" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">post</span><span
            class="method-args">(delay, *args, &task)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Post a task to be execute run after a given delay (in seconds). If the
delay is less than 1/100th of a second the task will be immediately post to
the executor.</p>

<p>@param [Float] delay the number of seconds to wait for before executing the
task. @param [Array&lt;Object&gt;] args the arguments passed to the task on
execution.</p>

<p>@yield the task to be performed.</p>

<p>@return [Concurrent::ScheduledTask, false] <a href="IVar.html">IVar</a>
representing the task if the post</p>

<pre>is successful; false after shutdown.</pre>

<p>@raise [ArgumentError] if the intended execution time is not in the future.
@raise [ArgumentError] if no block is given.</p>
          
          

          
          <div class="method-source-code" id="post-source">
            <pre><span class="ruby-comment"># File lib/concurrent/executor/timer_set.rb, line 48</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">post</span>(<span class="ruby-identifier">delay</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">task</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;no block given&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">running?</span>
  <span class="ruby-identifier">opts</span> = {
    <span class="ruby-identifier">executor</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@task_executor</span>,
    <span class="ruby-identifier">args</span><span class="ruby-operator">:</span> <span class="ruby-identifier">args</span>,
    <span class="ruby-identifier">timer_set</span><span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>
  }
  <span class="ruby-identifier">task</span> = <span class="ruby-constant">ScheduledTask</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-identifier">delay</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">task</span>) <span class="ruby-comment"># may raise exception</span>
  <span class="ruby-identifier">task</span>.<span class="ruby-identifier">unscheduled?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">task</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- post-source -->
          
        </div>

        

        
      </div><!-- post-method -->

    
    </section><!-- public-instance-method-details -->
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Private Instance Methods</h3>

    
      <div id="method-i-ns_initialize" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ns_initialize</span><span
            class="method-args">(opts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Initialize the object.</p>

<p>@param [Hash] opts the options to create the object with. @!visibility
private</p>
          
          

          
          <div class="method-source-code" id="ns_initialize-source">
            <pre><span class="ruby-comment"># File lib/concurrent/executor/timer_set.rb, line 76</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ns_initialize</span>(<span class="ruby-identifier">opts</span>)
  <span class="ruby-ivar">@queue</span>          = <span class="ruby-constant">Collection</span><span class="ruby-operator">::</span><span class="ruby-constant">NonConcurrentPriorityQueue</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">order</span><span class="ruby-operator">:</span> <span class="ruby-value">:min</span>)
  <span class="ruby-ivar">@task_executor</span>  = <span class="ruby-constant">Options</span>.<span class="ruby-identifier">executor_from_options</span>(<span class="ruby-identifier">opts</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">Concurrent</span>.<span class="ruby-identifier">global_io_executor</span>
  <span class="ruby-ivar">@timer_executor</span> = <span class="ruby-constant">SingleThreadExecutor</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@condition</span>      = <span class="ruby-constant">Event</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auto_terminate</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:auto_terminate</span>, <span class="ruby-keyword">true</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- ns_initialize-source -->
          
        </div>

        

        
      </div><!-- ns_initialize-method -->

    
      <div id="method-i-ns_post_task" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ns_post_task</span><span
            class="method-args">(task)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!visibility private</p>
          
          

          
          <div class="method-source-code" id="ns_post_task-source">
            <pre><span class="ruby-comment"># File lib/concurrent/executor/timer_set.rb, line 96</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ns_post_task</span>(<span class="ruby-identifier">task</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ns_running?</span>
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">task</span>.<span class="ruby-identifier">initial_delay</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0.01</span>
    <span class="ruby-identifier">task</span>.<span class="ruby-identifier">executor</span>.<span class="ruby-identifier">post</span>{ <span class="ruby-identifier">task</span>.<span class="ruby-identifier">process_task</span> }
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">task</span>)
    <span class="ruby-comment"># only post the process method when the queue is empty</span>
    <span class="ruby-ivar">@timer_executor</span>.<span class="ruby-identifier">post</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-value">:process_tasks</span>)) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
    <span class="ruby-ivar">@condition</span>.<span class="ruby-identifier">set</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- ns_post_task-source -->
          
        </div>

        

        
      </div><!-- ns_post_task-method -->

    
      <div id="method-i-ns_shutdown_execution" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ns_shutdown_execution</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>`ExecutorService` callback called during shutdown.</p>

<p>@!visibility private</p>
          
          

          
          <div class="method-source-code" id="ns_shutdown_execution-source">
            <pre><span class="ruby-comment"># File lib/concurrent/executor/timer_set.rb, line 123</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ns_shutdown_execution</span>
  <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-ivar">@timer_executor</span>.<span class="ruby-identifier">kill</span>
  <span class="ruby-identifier">stopped_event</span>.<span class="ruby-identifier">set</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- ns_shutdown_execution-source -->
          
        </div>

        

        
      </div><!-- ns_shutdown_execution-method -->

    
      <div id="method-i-post_task" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">post_task</span><span
            class="method-args">(task)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Post the task to the internal queue.</p>

<p>@note This is intended as a callback method from <a
href="ScheduledTask.html">ScheduledTask</a></p>

<pre>only. It is not intended to be used directly. Post a task
by using the `SchedulesTask#execute` method.</pre>

<p>@!visibility private</p>
          
          

          
          <div class="method-source-code" id="post_task-source">
            <pre><span class="ruby-comment"># File lib/concurrent/executor/timer_set.rb, line 91</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">post_task</span>(<span class="ruby-identifier">task</span>)
  <span class="ruby-identifier">synchronize</span>{ <span class="ruby-identifier">ns_post_task</span>(<span class="ruby-identifier">task</span>) }
<span class="ruby-keyword">end</span></pre>
          </div><!-- post_task-source -->
          
        </div>

        

        
      </div><!-- post_task-method -->

    
      <div id="method-i-process_tasks" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_tasks</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Run a loop and execute tasks in the scheduled order and at the approximate
scheduled time. If no tasks remain the thread will exit gracefully so that
garbage collection can occur. If there are no ready tasks it will sleep for
up to 60 seconds waiting for the next scheduled task.</p>

<p>@!visibility private</p>
          
          

          
          <div class="method-source-code" id="process_tasks-source">
            <pre><span class="ruby-comment"># File lib/concurrent/executor/timer_set.rb, line 135</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_tasks</span>
  <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">task</span> = <span class="ruby-identifier">synchronize</span> { <span class="ruby-ivar">@condition</span>.<span class="ruby-identifier">reset</span>; <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">peek</span> }
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">task</span>

    <span class="ruby-identifier">now</span> = <span class="ruby-constant">Concurrent</span>.<span class="ruby-identifier">monotonic_time</span>
    <span class="ruby-identifier">diff</span> = <span class="ruby-identifier">task</span>.<span class="ruby-identifier">schedule_time</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">now</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">diff</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
      <span class="ruby-comment"># We need to remove the task from the queue before passing</span>
      <span class="ruby-comment"># it to the executor, to avoid race conditions where we pass</span>
      <span class="ruby-comment"># the peek&#39;ed task to the executor and then pop a different</span>
      <span class="ruby-comment"># one that&#39;s been added in the meantime.</span>
      <span class="ruby-comment">#</span>
      <span class="ruby-comment"># Note that there&#39;s no race condition between the peek and</span>
      <span class="ruby-comment"># this pop - this pop could retrieve a different task from</span>
      <span class="ruby-comment"># the peek, but that task would be due to fire now anyway</span>
      <span class="ruby-comment"># (because @queue is a priority queue, and this thread is</span>
      <span class="ruby-comment"># the only reader, so whatever timer is at the head of the</span>
      <span class="ruby-comment"># queue now must have the same pop time, or a closer one, as</span>
      <span class="ruby-comment"># when we peeked).</span>
      <span class="ruby-identifier">task</span> = <span class="ruby-identifier">synchronize</span> { <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">pop</span> }
      <span class="ruby-identifier">task</span>.<span class="ruby-identifier">executor</span>.<span class="ruby-identifier">post</span>{ <span class="ruby-identifier">task</span>.<span class="ruby-identifier">process_task</span> }
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@condition</span>.<span class="ruby-identifier">wait</span>([<span class="ruby-identifier">diff</span>, <span class="ruby-value">60</span>].<span class="ruby-identifier">min</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- process_tasks-source -->
          
        </div>

        

        
      </div><!-- process_tasks-method -->

    
      <div id="method-i-remove_task" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_task</span><span
            class="method-args">(task)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Remove the given task from the queue.</p>

<p>@note This is intended as a callback method from `ScheduledTask`</p>

<pre>only. It is not intended to be used directly. Cancel a task
by using the `ScheduledTask#cancel` method.</pre>

<p>@!visibility private</p>
          
          

          
          <div class="method-source-code" id="remove_task-source">
            <pre><span class="ruby-comment"># File lib/concurrent/executor/timer_set.rb, line 116</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_task</span>(<span class="ruby-identifier">task</span>)
  <span class="ruby-identifier">synchronize</span>{ <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">task</span>) }
<span class="ruby-keyword">end</span></pre>
          </div><!-- remove_task-source -->
          
        </div>

        

        
      </div><!-- remove_task-method -->

    
    </section><!-- private-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 4.0.0.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

